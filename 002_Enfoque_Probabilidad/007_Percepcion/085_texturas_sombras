# Análisis de texturas y sombras usando Local Binary Pattern (LBP) y filtros de Gabor
# Requiere: pip install opencv-python scikit-image matplotlib numpy

import cv2
import numpy as np
from skimage.feature import local_binary_pattern
import matplotlib.pyplot as plt

# Cargar imagen
ruta_imagen = r"C:\Users\Kriki\OneDrive\Documentos\GitHub\IA_23110181\texturas.png"
imagen = cv2.imread(ruta_imagen)
if imagen is None:
    raise ValueError("No se pudo cargar la imagen. Verifica la ruta y el nombre del archivo.")

# Convertir a escala de grises
gris = cv2.cvtColor(imagen, cv2.COLOR_BGR2GRAY)

# --- Local Binary Pattern ---
radius = 3
n_points = 8 * radius
lbp = local_binary_pattern(gris, n_points, radius, method='uniform')

# --- Filtros Gabor ---
kernels = []
for theta in np.arange(0, np.pi, np.pi / 4):
    kern = cv2.getGaborKernel((21,21), 5, theta, 10, 0.5, 0, ktype=cv2.CV_32F)
    kernels.append(kern)

responses = [cv2.filter2D(gris, cv2.CV_8UC3, k) for k in kernels]

# --- Mostrar resultados ---
plt.figure(figsize=(12,6))
plt.subplot(2,3,1); plt.imshow(gris, cmap='gray'); plt.title("Original"); plt.axis('off')
plt.subplot(2,3,2); plt.imshow(lbp, cmap='gray'); plt.title("LBP"); plt.axis('off')
for i, resp in enumerate(responses):
    plt.subplot(2,3,3+i); plt.imshow(resp, cmap='gray'); plt.title(f"Gabor θ={i*np.pi/4:.2f}"); plt.axis('off')
plt.tight_layout()
plt.show()