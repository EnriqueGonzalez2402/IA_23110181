import numpy as np
import matplotlib.pyplot as plt

np.random.seed(0)

# Tiempo
T = 50

# Movimiento verdadero: velocidad constante 1 unidad/tiempo
x_true = np.linspace(0, 49, T)

# Medidas ruidosas
y = x_true + np.random.normal(0, 2, T)  # ruido gaussiano

# Inicialización del filtro de Kalman
x_est = np.zeros(T)  # estimación
P = np.zeros(T)      # varianza de estimación
x_est[0] = 0
P[0] = 1

Q = 0.01  # varianza del proceso
R = 4     # varianza de la medición

# Filtro de Kalman
for t in range(1, T):
    # Predicción
    x_pred = x_est[t-1] + 1  # modelo de movimiento: x_t = x_{t-1}+1
    P_pred = P[t-1] + Q

    # Actualización
    K = P_pred / (P_pred + R)  # ganancia de Kalman
    x_est[t] = x_pred + K * (y[t] - x_pred)
    P[t] = (1 - K) * P_pred

# Graficamos
plt.figure(figsize=(10,5))
plt.plot(x_true, label="Posición verdadera")
plt.plot(y, label="Mediciones ruidosas", alpha=0.5)
plt.plot(x_est, label="Estimación Kalman")
plt.legend()
plt.title("Filtro de Kalman – Movimiento 1D")
plt.show()